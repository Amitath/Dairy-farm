{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h2>Dashboard</h2>

<!-- REMINDERS SECTION -->
{% if upcoming_calving_reminders or upcoming_vaccination_reminders %}
    <div class="reminders-section">
        <h3>Upcoming Reminders</h3>
        <div class="reminders-grid">
            {% if upcoming_calving_reminders %}
                <div class="card reminder-card urgent">
                    <h4>Upcoming Calving Dates</h4>
                    <ul>
                        {% for cow in upcoming_calving_reminders %}
                            <li>
                                <strong>{{ cow.name }} ({{ cow.cow_id }})</strong> due on
                                {{ cow.expected_calving_date.strftime('%Y-%m-%d') }}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            {% if upcoming_vaccination_reminders %}
                <div class="card reminder-card warning">
                    <h4>Upcoming / Overdue Vaccinations</h4>
                    <ul>
                        {% for vac in upcoming_vaccination_reminders %}
                            <li class="{% if vac.next_due_date < today %}overdue{% endif %}">
                                <strong>{{ vac.cow.name }} ({{ vac.cow.cow_id }})</strong> needs 
                                {{ vac.vaccine_name }} by {{ vac.next_due_date.strftime('%Y-%m-%d') }}
                                {% if vac.next_due_date < today %} (OVERDUE){% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
    </div>
{% endif %}
<!-- END REMINDERS SECTION -->


<div class="dashboard-grid">
    <div class="card">
        <h3>Total Cows</h3>
        <p>{{ total_cows }}</p>
    </div>
    <div class="card">
        <h3>Active Cows</h3>
        <p>{{ active_cows }}</p>
    </div>
    <div class="card">
        <h3>Today's Milk Production</h3>
        <p>{{ "%.2f"|format(total_today_milk) }} Liters</p>
    </div>
    <div class="card">
        <h3>Total Amount Receivable</h3>
        <p>RWF {{ "%.2f"|format(total_receivable) }}</p>
    </div>
</div>

<h3>Recent Sales</h3>
{% if recent_sales %}
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Customer</th>
                    <th>Quantity (L)</th>
                    <th>Total Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for sale in recent_sales %}
                <tr>
                    <td>{{ sale.date.strftime('%Y-%m-%d') }}</td>
                    <td>{{ sale.customer.name }}</td>
                    <td>{{ "%.2f"|format(sale.milk_quantity_liters) }}</td>
                    <td>RWF {{ "%.2f"|format(sale.total_amount) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p>No recent sales.</p>
{% endif %}

<h3>Recent Expenses</h3>
{% if recent_expenses %}
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Category</th>
                    <th>Amount</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                {% for expense in recent_expenses %}
                <tr>
                    <td>{{ expense.date.strftime('%Y-%m-%d') }}</td>
                    <td>{{ expense.category }}</td>
                    <td>RWF {{ "%.2f"|format(expense.amount) }}</td>
                    <td>{{ expense.description }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p>No recent expenses.</p>
{% endif %}
{% endblock %}
